<script>
  import * as CookieConsent from "vanilla-cookieconsent";
  import "vanilla-cookieconsent/dist/cookieconsent.css";

  declare global {
    interface Window {
      posthog: any;
      Reo: any;
    }
  }

  // See https://cookieconsent.orestbida.com/reference/configuration-reference.html for configuration options.
  const config: Parameters<typeof CookieConsent.run>[0] = {
    // Default configuration for the modal.
    root: "body",
    autoShow: true,
    disablePageInteraction: false,
    hideFromBots: import.meta.env.PROD ? true : false, // Set this to false for dev/headless tests otherwise the modal will not be visible.
    mode: "opt-in",
    // Bump the revision field when you add new services
    revision: 1,

    // Default configuration for the cookie.
    cookie: {
      name: "cc_cookie",
      // Use .opensaas.sh domain to share consent with main site
      domain: location.hostname.includes("opensaas.sh")
        ? ".opensaas.sh"
        : location.hostname,
      path: "/",
      sameSite: "Lax",
      expiresAfterDays: 365,
    },

    guiOptions: {
      consentModal: {
        layout: "box",
        position: "bottom right",
        equalWeightButtons: true,
        flipButtons: false,
      },
    },

    categories: {
      necessary: {
        enabled: true, // this category is enabled by default
        readOnly: true, // this category cannot be disabled
      },
      analytics: {
        autoClear: {
          cookies: [
            {
              name: /^_ga/, // regex: match all cookies starting with '_ga'
            },
            {
              name: "_gid", // string: exact cookie name
            },
            {
              name: /^__sec__/, // regex: match all REO.dev cookies (https://docs.reo.dev/integrations/tracking-beacon/reo.dev-javascript-cookies-and-consent-guide#key-features-of-reo.dev-cookies)
            },
            {
              name: /^ph_/, // regex: match all PostHog cookies
            },
          ],
        },

        // https://cookieconsent.orestbida.com/reference/configuration-reference.html#category-services
        services: {
          posthog: {
            label: "PostHog",
            onAccept: async () => {
              try {
                await CookieConsent.loadScript("/scripts/posthog.js");
              } catch (error) {
                console.error(error);
              }
            },
            onReject: () => {},
          },
          reo: {
            label: "REO.dev",
            onAccept: async () => {
              try {
                await CookieConsent.loadScript("/scripts/reo.js");
              } catch (error) {
                console.error(error);
              }
            },
            onReject: () => {},
          },
        },
      },
    },

    language: {
      default: "en",
      translations: {
        en: {
          consentModal: {
            title: "We use cookies",
            description:
              "We use cookies primarily for analytics to enhance your experience. By accepting, you agree to our use of these cookies. You can manage your preferences or learn more about our cookie policy.",
            acceptAllBtn: "Accept all",
            acceptNecessaryBtn: "Reject all",
            // showPreferencesBtn: 'Manage Individual preferences', // (OPTIONAL) Activates the preferences modal
            footer: `<a href="/general/privacy-policy/">Privacy Policy</a>`,
          },
          // The showPreferencesBtn activates this modal to manage individual preferences https://cookieconsent.orestbida.com/reference/configuration-reference.html#translation-preferencesmodal
          preferencesModal: {
            sections: [],
          },
        },
      },
    },
  };

  CookieConsent.run(config);
</script>
