---
name: validating-pre-deployment
description: validate configuration and test production build before deploying.
---

# validating-pre-deployment

Pre-deployment validation checks that catch common issues before deploying with the [deploying-app skill](../deploying-app/SKILL.md).

## Before Starting

1. verify user is in the app directory (check for `main.wasp` or `main.wasp.ts`)
2. ask: "Would you like me to run pre-deployment checks on your Open SaaS app?"

## Validation Steps

Run these checks in order. Report all issues found, then ask the user if they want to proceed or fix issues first.

### Step 1: Wasp Config Metadata

Check the wasp config file (`main.wasp` or `main.wasp.ts`) `app` block for placeholder values:

**App Identity:**
- `app.title` - should NOT be "My Open SaaS App" or contain "Open SaaS"
- `app.name` - should be customized (PascalCase identifier)

**Head Meta Tags (in `app.head`):**
- `<meta name='description'...` - should NOT contain "Your app" placeholder text
- `<meta name='author'...` - should NOT be "Your (App) Name"
- `<meta property='og:title'...` - should match actual app title
- `<meta property='og:site_name'...` - should match actual app name
- `<meta property='og:url'...` - should NOT be "https://your-saas-app.com" or a placeholder value
- `<meta property='og:description'...` - should NOT contain placeholder text
- `<meta property='og:image'...` - should point to actual hosted image URL
- `<meta name='twitter:image'...` - should point to actual hosted image URL

Confirm that URLs are actual live URLs, not placeholder values set during the setup wizard.

**Analytics Scripts:**
- Plausible scripts should have actual domain (not `<your-site-id>`)
- OR scripts should be removed/commented if not using Plausible

**Email Configuration:**
- `auth.methods.email.fromField.email` - should NOT be "me@example.com"
- `emailSender.defaultFrom.email` - should NOT be "me@example.com"
- `emailSender.provider` - should NOT be "Dummy" for production

Report format:
```
## Configuration Issues Found

### Critical (must fix):
- [ ] issue description

### Warnings (recommended to fix):
- [ ] issue description

### Passed:
- [x] check that passed
```

### Step 2: Environment Variables

Based on the wasp config, generate a checklist of required env vars for the user to verify. **Do NOT read .env files** - ask the user to confirm they have the required variables set.

Present the checklist based on what's configured:

```
## Environment Variables Checklist

Please verify you have these variables ready for deployment:

### Server Variables (.env.server)
- [ ] DATABASE_URL - auto-set by Railway/Fly, no action needed
- [ ] JWT_SECRET - auto-generated by Wasp CLI deploy

### Based on Your Config:
[Generate this list by checking main.wasp for enabled features]
```

**If OAuth providers enabled:**
- Google: `GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET`
- GitHub: `GITHUB_CLIENT_ID`, `GITHUB_CLIENT_SECRET`
- Discord: `DISCORD_CLIENT_ID`, `DISCORD_CLIENT_SECRET`
- etc.

**If email provider is SendGrid/Mailgun/SMTP:**
- SendGrid: `SENDGRID_API_KEY`
- Mailgun: `MAILGUN_API_KEY`, `MAILGUN_DOMAIN`
- SMTP: `SMTP_HOST`, `SMTP_PORT`, `SMTP_USERNAME`, `SMTP_PASSWORD`

**If file uploads configured:**
- `AWS_S3_REGION`, `AWS_S3_FILES_BUCKET`, `AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`

**If OpenAI integration used:**
- `OPENAI_API_KEY`

**If payment provider configured:**
- Remind user to switch from test/sandbox keys to **production keys**
- Stripe: `STRIPE_API_KEY` (live key), `STRIPE_WEBHOOK_SECRET`
- Lemon Squeezy: `LEMONSQUEEZY_API_KEY`, `LEMONSQUEEZY_WEBHOOK_SECRET`
- Polar: `POLAR_ACCESS_TOKEN`, `POLAR_WEBHOOK_SECRET`, set `POLAR_SANDBOX_MODE=false`
- See [configuring-payments skill](../configuring-payments/SKILL.md) for full setup

**Client Variables:**
- List any `REACT_APP_*` vars needed
- Remind user: "Client env vars must be passed at deploy time, not set in hosting dashboards."

Ask user: "Do you have all the required environment variables ready? (yes/no)"

### Step 3: Production Configuration Reminders

Based on enabled features, remind user of production setup tasks:

**If OAuth providers enabled:**
- Remind user: "Add your production domain to OAuth redirect URLs in each provider's dashboard"
- Format: `https://your-domain.com/auth/<provider>/callback`

**If payment provider configured:**
- Stripe: Create production webhook endpoint at `https://your-domain.com/payments-webhook`
- Lemon Squeezy: Configure webhook with events: `order_created`, `subscription_created`, `subscription_updated`, `subscription_cancelled`
- Polar: Create webhook endpoint, disable sandbox mode

**If AWS S3 file uploads used:**
- Remind user: "Add your production domain to S3 bucket CORS `AllowedOrigins`"

### Step 4: Database Migrations

Check for pending migrations:
```bash
# List migration files
ls -la migrations/
```

Remind user:
- Production automatically applies pending migrations on server start
- Ensure migrations are committed to version control
- Test migrations work locally before deploying

### Step 5: Production Build Test

Ask user: "Would you like to test the production build locally? This catches environment-specific issues."

If yes, guide through:

1. Start database (if not running):
   ```bash
   wasp start db
   ```

2. Run production build test:
   ```bash
   wasp build start --server-env DATABASE_URL=<from-.env.server> --server-env JWT_SECRET=test-secret-for-local
   ```

   Or with env file:
   ```bash
   wasp build start --server-env-file .env.server
   ```

3. Verify app loads at `http://localhost:3000`

4. Check for:
   - Build compilation errors
   - Runtime errors in console
   - Missing env var errors

If issues found, help debug before proceeding.

### Step 6: Final Checklist

Present summary:

```
## Pre-Deployment Summary

### Configuration Status:
- App Name: [name]
- App Title: [title]
- Email Provider: [provider]
- Auth Methods: [list]
- Payment Provider: [if configured]

### Issues to Resolve:
[list any issues from steps 1-4]

### Before Deploying:
- [ ] All configuration placeholders replaced
- [ ] Production email provider configured
- [ ] Required env vars ready for deployment
- [ ] Production build tested locally (optional but recommended)
- [ ] Database migrations committed

### Ready to Deploy?
```

## Completion

If all checks pass or user chooses to proceed:
- Summarize what was validated
- Ask: "Would you like to proceed with deployment? I can guide you through deploying to Railway or Fly.io."
- If yes, transition to [deploying-app skill](../deploying-app/SKILL.md)

## Documentation

Fetch guide URLs directly:
- https://docs.opensaas.sh/llms.txt

If you need more specific info, use mcp__wasp-docs__find_docs to search.
